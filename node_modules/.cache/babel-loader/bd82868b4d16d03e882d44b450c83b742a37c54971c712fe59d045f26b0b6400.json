{"ast":null,"code":"import React,{useRef,useState}from'react';import{useDraggable}from'@dnd-kit/core';import{useCardProgress}from'./useCardProgress';import CardMenu from'./CardMenu';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const STATUSES=['Ideas','In Progress','Completed'];const DraggableCard=_ref=>{let{card,columnId,onCardClick,onMoveCard,isDragging,snap}=_ref;const[localColor,setLocalColor]=useState(card.color||'default');const cardRef=useRef(null);// Update color in Firestore and local state\nconst handleSetColor=async color=>{setLocalColor(color);try{const{doc,updateDoc}=await import('firebase/firestore');await updateDoc(doc(require('../firebase').db,'cards',card.id),{color});}catch(e){/* fail silently for now */}};const{attributes,listeners,setNodeRef,transform}=useDraggable({id:card.id});// Card color logic\nconst colorMap={default:{bg:'#fff',border:'#e5e7eb',text:'#222'},blue:{bg:'#e0edfa',border:'#60a5fa',text:'#1e293b'},green:{bg:'#e5f6e7',border:'#34d399',text:'#14532d'},yellow:{bg:'#fffbe5',border:'#fbbf24',text:'#78350f'},red:{bg:'#fdeaea',border:'#f87171',text:'#7f1d1d'},purple:{bg:'#f3e8ff',border:'#a78bfa',text:'#4b006e'},grey:{bg:'#f3f4f6',border:'#9ca3af',text:'#222'}};const colorKey=localColor||'default';const color=colorMap[colorKey]||colorMap.default;const style={transform:transform?`translate3d(${transform.x}px, ${transform.y}px, 0)`:undefined,opacity:isDragging?0.5:1,background:color.bg,borderColor:color.border,color:color.text,boxShadow:'0 1px 6px 0 rgba(60,60,60,0.08)'};const idx=STATUSES.indexOf(columnId);// live progress per card\nconst{progress,tasksCount}=useCardProgress(card.id);return/*#__PURE__*/_jsxs(\"div\",{ref:setNodeRef,...listeners,...attributes,onClick:()=>{if(!isDragging)onCardClick(card);},style:style,className:`kanban-card rounded-card shadow-card px-4 py-3 border-l-4 ${card.pinned?'border-accent':'border-transparent'} max-w-full relative select-none animate-card-entry ${isDragging?'opacity-60 border-2 border-accent transition-none':'transition-shadow'}${snap?' snap-in':''}`,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between cursor-pointer group\",ref:cardRef,children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-800 break-words max-w-full line-clamp-3 overflow-hidden text-ellipsis whitespace-pre-line leading-snug\",title:card.title,children:card.title}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity z-10\",children:/*#__PURE__*/_jsx(CardMenu,{anchorRef:cardRef,color:localColor,onSetColor:handleSetColor})}),card.pinned&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute top-2 right-8 text-[10px] text-accent font-bold bg-accent/10 px-2 py-0.5 rounded shadow-sm\",children:\"PINNED\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start justify-between cursor-pointer group\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-gray-800 break-words max-w-full line-clamp-3 overflow-hidden text-ellipsis whitespace-pre-line leading-snug\",title:card.title,children:card.title}),/*#__PURE__*/_jsx(\"div\",{className:\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity z-10\",children:/*#__PURE__*/_jsx(CardMenu,{anchorRef:cardRef,color:localColor,onSetColor:handleSetColor})}),card.pinned&&/*#__PURE__*/_jsx(\"span\",{className:\"absolute top-2 right-8 text-[10px] text-accent font-bold bg-accent/10 px-2 py-0.5 rounded shadow-sm\",children:\"PINNED\"})]}),card.dueDate&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500 mt-1\",children:[\"Due: \",card.dueDate]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 flex gap-2\",children:[idx>0&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();onMoveCard(card,STATUSES[idx-1]);},className:\"btn px-2 py-1 bg-gray-200 rounded hover:bg-gray-300\",children:\"\\u2190\"}),idx<STATUSES.length-1&&/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();onMoveCard(card,STATUSES[idx+1]);},className:\"btn px-2 py-1 bg-gray-200 rounded hover:bg-gray-300\",children:\"\\u2192\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded h-1.5 overflow-hidden\",children:/*#__PURE__*/_jsx(\"div\",{className:tasksCount>0?\"bg-accent h-1.5 rounded transition-all duration-300\":\"bg-gray-300 h-1.5 rounded\",style:{width:`${progress}%`}})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-[10px] text-gray-400 mt-1 text-right\",children:tasksCount>0?`${Math.round(progress)}% complete`:'0% complete'})]})]});};export default DraggableCard;","map":{"version":3,"names":["React","useRef","useState","useDraggable","useCardProgress","CardMenu","jsx","_jsx","jsxs","_jsxs","STATUSES","DraggableCard","_ref","card","columnId","onCardClick","onMoveCard","isDragging","snap","localColor","setLocalColor","color","cardRef","handleSetColor","doc","updateDoc","require","db","id","e","attributes","listeners","setNodeRef","transform","colorMap","default","bg","border","text","blue","green","yellow","red","purple","grey","colorKey","style","x","y","undefined","opacity","background","borderColor","boxShadow","idx","indexOf","progress","tasksCount","ref","onClick","className","pinned","children","title","anchorRef","onSetColor","dueDate","stopPropagation","length","width","Math","round"],"sources":["C:/Users/aikid/CascadeProjects/chalet-fractal-flow/src/components/DraggableCard.tsx"],"sourcesContent":["import React, { FC, useRef, useState } from 'react';\nimport { useDraggable } from '@dnd-kit/core';\nimport type { CardData } from './KanbanBoard';\nimport { useCardProgress } from './useCardProgress';\nimport CardMenu from './CardMenu';\n\nconst STATUSES = ['Ideas', 'In Progress', 'Completed'];\n\ninterface DraggableCardProps {\n  card: CardData;\n  columnId: string;\n  onCardClick: (card: CardData) => void;\n  onMoveCard: (card: CardData, newStatus: string) => void;\n  isDragging: boolean;\n  snap?: boolean;\n  onSetColor?: (color: string) => void;\n}\n\nconst DraggableCard: FC<DraggableCardProps> = ({ card, columnId, onCardClick, onMoveCard, isDragging, snap }) => {\n  const [localColor, setLocalColor] = useState(card.color || 'default');\n  const cardRef = useRef<HTMLDivElement>(null);\n\n  // Update color in Firestore and local state\n  const handleSetColor = async (color: string) => {\n    setLocalColor(color);\n    try {\n      const { doc, updateDoc } = await import('firebase/firestore');\n      await updateDoc(doc(require('../firebase').db, 'cards', card.id), { color });\n    } catch (e) { /* fail silently for now */ }\n  };\n  const { attributes, listeners, setNodeRef, transform } = useDraggable({ id: card.id });\n  // Card color logic\n  const colorMap: Record<string, { bg: string; border: string; text: string }> = {\n    default: { bg: '#fff', border: '#e5e7eb', text: '#222' },\n    blue:    { bg: '#e0edfa', border: '#60a5fa', text: '#1e293b' },\n    green:   { bg: '#e5f6e7', border: '#34d399', text: '#14532d' },\n    yellow:  { bg: '#fffbe5', border: '#fbbf24', text: '#78350f' },\n    red:     { bg: '#fdeaea', border: '#f87171', text: '#7f1d1d' },\n    purple:  { bg: '#f3e8ff', border: '#a78bfa', text: '#4b006e' },\n    grey:    { bg: '#f3f4f6', border: '#9ca3af', text: '#222' },\n  };\n  const colorKey = localColor || 'default';\n  const color = colorMap[colorKey] || colorMap.default;\n\n  const style = {\n    transform: transform ? `translate3d(${transform.x}px, ${transform.y}px, 0)` : undefined,\n    opacity: isDragging ? 0.5 : 1,\n    background: color.bg,\n    borderColor: color.border,\n    color: color.text,\n    boxShadow: '0 1px 6px 0 rgba(60,60,60,0.08)',\n  };\n  const idx = STATUSES.indexOf(columnId);\n\n  // live progress per card\n  const { progress, tasksCount } = useCardProgress(card.id);\n\n  return (\n    <div\n      ref={setNodeRef}\n      {...listeners}\n      {...attributes}\n      onClick={() => { if (!isDragging) onCardClick(card); }}\n      style={style}\n      className={`kanban-card rounded-card shadow-card px-4 py-3 border-l-4 ${card.pinned ? 'border-accent' : 'border-transparent'} max-w-full relative select-none animate-card-entry ${isDragging ? 'opacity-60 border-2 border-accent transition-none' : 'transition-shadow'}${snap ? ' snap-in' : ''}`}\n    >\n      <div className=\"flex items-start justify-between cursor-pointer group\" ref={cardRef}>\n        <span className=\"font-medium text-gray-800 break-words max-w-full line-clamp-3 overflow-hidden text-ellipsis whitespace-pre-line leading-snug\" title={card.title}>{card.title}</span>\n        <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity z-10\">\n          <CardMenu anchorRef={cardRef} color={localColor} onSetColor={handleSetColor} />\n        </div>\n        {card.pinned && <span className=\"absolute top-2 right-8 text-[10px] text-accent font-bold bg-accent/10 px-2 py-0.5 rounded shadow-sm\">PINNED</span>}\n      </div>\n      <div className=\"flex items-start justify-between cursor-pointer group\">\n        <span className=\"font-medium text-gray-800 break-words max-w-full line-clamp-3 overflow-hidden text-ellipsis whitespace-pre-line leading-snug\" title={card.title}>{card.title}</span>\n        <div className=\"absolute top-2 right-2 opacity-0 group-hover:opacity-100 group-focus-within:opacity-100 transition-opacity z-10\">\n          <CardMenu anchorRef={cardRef} color={localColor} onSetColor={handleSetColor} />\n        </div>\n        {card.pinned && <span className=\"absolute top-2 right-8 text-[10px] text-accent font-bold bg-accent/10 px-2 py-0.5 rounded shadow-sm\">PINNED</span>}\n      </div>\n      {card.dueDate && <div className=\"text-xs text-gray-500 mt-1\">Due: {card.dueDate}</div>}\n      <div className=\"mt-2 flex gap-2\">\n        {idx > 0 && (\n          <button\n            onClick={e => { e.stopPropagation(); onMoveCard(card, STATUSES[idx - 1]); }}\n            className=\"btn px-2 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n          >\n            ←\n          </button>\n        )}\n        {idx < STATUSES.length - 1 && (\n          <button\n            onClick={e => { e.stopPropagation(); onMoveCard(card, STATUSES[idx + 1]); }}\n            className=\"btn px-2 py-1 bg-gray-200 rounded hover:bg-gray-300\"\n          >\n            →\n          </button>\n        )}\n      </div>\n      {/* Progress Bar at bottom */}\n      <div className=\"mt-3\">\n        <div className=\"w-full bg-gray-200 rounded h-1.5 overflow-hidden\">\n          <div\n            className={tasksCount > 0 ? \"bg-accent h-1.5 rounded transition-all duration-300\" : \"bg-gray-300 h-1.5 rounded\"}\n            style={{ width: `${progress}%` }}\n          />\n        </div>\n        <div className=\"text-[10px] text-gray-400 mt-1 text-right\">\n          {tasksCount > 0 ? `${Math.round(progress)}% complete` : '0% complete'}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default DraggableCard;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}